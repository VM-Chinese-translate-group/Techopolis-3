name: å‘å¸ƒæ­£å¼ç‰ˆ (Create Release)

on:
  workflow_dispatch:
    inputs:
      patch_version:
        description: 'â¡ï¸ æ±‰åŒ–è¡¥ä¸è‡ªèº«çš„ç‰ˆæœ¬å·'
        required: true
        type: string
      game_version:
        description: 'â¡ï¸ æ±‰åŒ–è¡¥ä¸å¯¹åº”çš„æ¸¸æˆç‰ˆæœ¬'
        required: true
        type: string
      release_notes:
        description: 'âœï¸ [å¯é€‰] è¾“å…¥æœ¬æ¬¡å‘å¸ƒçš„æ›´æ–°æ—¥å¿— (æ”¯æŒ Markdown)'
        required: false
        type: string
        default: 'æ— '

jobs:
  create-release:
    name: åˆ›å»ºå¹¶å‘å¸ƒæ­£å¼ç‰ˆ
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout main branch
        uses: actions/checkout@v4

      - name: Redirect opolisutilities assets directory
        run: |
          SOURCE_DIR="CNPack/kubejs/assets/opolisutilities/"
          DEST_DIR="CNPack/resourcepacks/VM Language Override/assets/opolisutilities"
          if [ -d "$SOURCE_DIR" ]; then
            echo "æ­£åœ¨å‡†å¤‡æ‰“åŒ…ï¼šç§»åŠ¨ '$SOURCE_DIR' çš„å†…å®¹åˆ° '$DEST_DIR'..."
            # ä½¿ç”¨ rsync ç§»åŠ¨æ–‡ä»¶ï¼Œ--remove-source-files ä¼šåœ¨æˆåŠŸååˆ é™¤æºæ–‡ä»¶å’Œç›®å½•
            rsync -av --remove-source-files "$SOURCE_DIR" "$DEST_DIR"
            echo "ç›®å½•é‡å®šå‘å®Œæˆã€‚"
          else
            echo "è­¦å‘Šï¼šæºç›®å½• '$SOURCE_DIR' ä¸å­˜åœ¨ï¼Œè·³è¿‡é‡å®šå‘æ­¥éª¤ã€‚"
          fi

      - name: Zip CNPack folder
        run: zip -r "VM-CNPack-v${{ github.event.inputs.patch_version }}.zip" ./CNPack

      - name: Create GitHub Release
        uses: ncipollo/release-action@v1
        with:
          tag: "v${{ github.event.inputs.patch_version }}"
          name: "æ­£å¼ç‰ˆ v${{ github.event.inputs.patch_version }}"
          body: |
            ## âœ¨ å‘å¸ƒè¯¦æƒ…

            - **æ±‰åŒ–è¡¥ä¸ç‰ˆæœ¬**: `v${{ github.event.inputs.patch_version }}`
            - **å¯¹åº”æ¸¸æˆç‰ˆæœ¬**: `${{ github.event.inputs.game_version }}`

            ---

            ## ğŸ“ æ›´æ–°æ—¥å¿—

            ${{ github.event.inputs.release_notes }}

            ---

            è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨æ„å»ºçš„æ­£å¼ç‰ˆæ±‰åŒ–è¡¥ä¸ã€‚
            æ­¤ç‰ˆæœ¬åŸºäº `main` åˆ†æ”¯çš„æœ€æ–°ä»£ç ç”Ÿæˆã€‚

          artifacts: "VM-CNPack-v${{ github.event.inputs.patch_version }}.zip"
          
          prerelease: false